<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>fwdpp: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fwdpp
   &#160;<span id="projectnumber">0.8.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">fwdpp Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>fwdpp - A C++ template library for forward-time population genetic simulations</p>
<p>Copyright (C) 2013 Kevin Thornton</p>
<p>fwdpp is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</p>
<p>Comments are welcome. </p><pre class="fragment">    - Kevin Thornton &lt;krthornt@uci.edu&gt;
</pre><h1>Preface</h1>
<p>This README is the main page of the fwdpp documentation. It may display some things oddly when viewed on GitHub and/or links to other documentation pages may be broken. These issues are not bugs &ndash; please see the Reference Manual at the <a href="http://molpopgen.github.io/fwdpp/">fwdpp home page</a> for a fully-formatted version of this document.</p>
<h1>Using simulations in Python</h1>
<p>If you are reading this, I'm guessing that you are more interested in <em>running</em> forward simulations than you are in <em>developing</em> them. This package is about the latter. I'd recommend that you check out <a href="http://molpopgen.github.io/fwdpy11">fwdpy11</a>, which is a Python package for running forward simulations and processing the output. <a href="http://molpopgen.github.io/fwdpy11">fwdpy11</a> is developed using fwdpp (this package). <a href="http://molpopgen.github.io/fwdpy11">fwdpy11</a> is obtainable from GitHub and will soon be avalable from <a href="http://pypi.python.org">PyPi</a> or via the <a href="https://bioconda.github.io/">bioconda</a> channel of <a href="https://www.continuum.io/downloads">Anaconda</a>.</p>
<p>fwdpy11 replaces <a href="http://molpopgen.github.io/fwdpy">fwdpy</a>, which was a Cython-based package for enabling fwdpp-based simulations in Python. We've end-of-life'd that project, but it is still on PyPi/Bioconda/GitHub for archival purposes, as a couple of publications used it. Trust us, though, <a href="http://molpopgen.github.io/fwdpy11">fwdpy11</a> does everything fwdpy did, but better.</p>
<h1>fwdpp-users mailing list</h1>
<p>There is a <a href="https://groups.google.com/forum/#!forum/fwdpp-users">Google Group</a> for fwdpp users. It is called fwdpp-users. I prefer that questions, etc., are raised there. Questions on that list that are determined to be real issues will result in issue tickets on the GitHub repo for this site. The group is also a good place for installation help, use questions, etc.</p>
<h1>Build status</h1>
<ul>
<li>Status of master branch: <a href="https://travis-ci.org/molpopgen/fwdpp"></a> <a href="https://circleci.com/gh/molpopgen/fwdpp/tree/master"></a></li>
<li>Status of dev branch: <a href="https://travis-ci.org/molpopgen/fwdpp"></a> <a href="https://circleci.com/gh/molpopgen/fwdpp/tree/dev"></a></li>
</ul>
<h1>Introduction</h1>
<p>fwdpp is a C++ template library that abstracts the basic operations required to implement forward-time simulations of population- and quantitative-genetic models. The library allows the simulation of single populations or metapopulations evolving under the standard evolutionary forces of drift, recombination, migration, and natural selection. Arbitrary population size changes are also allowed. Different populations in a metapopulation may evolve under different fitness schemes.</p>
<p>The library uses advanced C++ techniques to allow arbitrary models to be implemented via the implementation of simple policies (see Documentation section below). A programmer wishing to use the library will need a strong background in templates, function objects, and the Standard Template Library (STL). Web resources for these topics vary too much in quality to recommend any particular one. However, there are several classic books that are must-reads for C++ programmers (old school, I know):</p>
<ol type="1">
<li>Scott Meyer's "trilogy" of "Effective C++", "More Effective C++", and "Effective STL".</li>
<li>Nicolai Josuttis' "The C++ Standard Template Library"</li>
<li>David Vandevoorde and Nicolai Josuttis, "C++ Templates"</li>
</ol>
<p>The first two are excellent books for people already familiar with C++ syntax but want to know more about effective software design using the language. Meyer's books are particularly good, espectially the first two. The C++ Templates book is a bible of how to get the most out of templates. It is a very advanced and detailed book, but I've found it helpful over the years.</p>
<h2>A note about which version to use</h2>
<p>This code is distributed via my GitHub <a href="http://www.github.com/molpopgen">account</a>. The "master" and "dev" branches should be viewed as experimental. The <a href="https://github.com/molpopgen/fwdpp/releases">releases</a>, however, correspond to tested versions of the library fit for public consumption. This means that, while the version number in the configure script on master/dev may match that of a recent release, <em>that does not mean that the features/stability/bugs present in master/dev are identical to those of the release.</em> If you want to use fwdpp for research, use the latest <a href="https://github.com/molpopgen/fwdpp/releases">release</a>. If you want to play around with the latest and (occasionally not-so) greatest, look at the dev branch. If you want to look at the latest I believe to be stable, look at master. Also note that master may be ahead of dev, etc., depending on what I've committed from my development server to the repo stored at github.</p>
<h3>Revision history</h3>
<p><a class="el" href="d0/d00/md_md_RELEASE_NOTES.html">Release notes</a></p>
<p>You should pay particular attention to any statements about backwards compatibility. If you are updating from a previous version of <b>fwdpp</b>, you may wish to read this document regarding how to reproduce results based on previous versions: md_md_preproc.</p>
<p>Specific version numbers ("tags" in git-ese, a.k.a. "releases") will occur when new feature are added to the library and/or bugs are fixed. The details of what happens in each release can be found <a class="el" href="d0/d00/md_md_RELEASE_NOTES.html">here</a>, beginning with release 0.2.4.</p>
<h2>Which C++?</h2>
<p>As of version 0.2.5, fwdpp requires a compiler supporting the "C++11" version of the language. Currently, fwdpp requires that your compiler support the flag -std=c++11 in order to use c++11 language features. Recent version of GCC and clang both support this option, which covers most Linux and OS X users.</p>
<h2>Citation</h2>
<p>The fwdpp manuscript has published in Genetics. The accepted version of the manuscript is <a href="http://www.genetics.org/content/early/2014/06/19/genetics.114.165019.abstract">here</a>. For LaTeX users:</p>
<div class="fragment"><div class="line">@Article{,</div><div class="line">  author =       {K. R. Thornton},</div><div class="line">  title =        {A C++ Template Library for Efficient Forward-Time Population Genetic Simulation of Large Populations},</div><div class="line">  journal =      {Genetics},</div><div class="line">  year =         {2014},</div><div class="line">  OPTkey =       {},</div><div class="line">  volume =       {198},</div><div class="line">  OPTnumber =    {},</div><div class="line">  pages =        {157-166},</div><div class="line">  OPTmonth =     {},</div><div class="line">  OPTnote =      {},</div><div class="line">  annote =       {doi:/10.1534/genetics.114.165019}</div><div class="line">}</div></div><!-- fragment --><p>The version of fwdpp used in that publication is 0.2.4.</p>
<h3>Where fwdpp is now (compared to the publication).</h3>
<p>The published version of fwdpp described a library with the following features:</p>
<ul>
<li>Objects (mutations and haploid genomes) are stored only once in <em>doubly-linked lists</em>.</li>
<li>Diploids are pairs of pointers to haploid genomes (technically, pairs of iterators derived from the list of haploid genomes).</li>
<li>Gametes contain vectors of pointers (again, C++ iterators) to mutations.</li>
<li>Each generation, extinct mutations and haploid genomes are removed from the population. This removal is a constant-time operation due to the use of linked lists.</li>
</ul>
<p>This design had a certain elegance to it. A pointer to a diploid gave you immediate access to the mutations by means of the pointer structure. It was also compact in memory, because iterators are only 8 bytes (on a 64-bit system) while haploid genomes and mutations are 64 and <em>at least</em> 48 bytes, respectively.</p>
<p>The fwdpp publication showed that the library performs well in terms of speed compared to other tools out there. However, the original design had the following problems:</p>
<ul>
<li>Several lookup operations were implemented using expensive linear-time searches.</li>
<li>The linked lists plus the constant insertion and deletion of new and extinct objects, respectively, resulted in memory fragmentation or poor "cache locality".</li>
</ul>
<p>The 0.3.x releases of fwdpp solved most of the first problem, and sped the library up by over an order of magnitude. To address the second problem (poor cache locality), I recommended that users link programs based on fwdpp to an external library replacing the built-in malloc (the main memory allocation function for the C family of languages, and C++'s "new" is a wrapper around malloc). I specifically recommended using Google's tcmalloc. It turned out that simply using an industrial-strength memory allocator went a long way towards addressing the performance hit due to memory fragmentation.</p>
<p>(These releases also introduced various sub-libraries aimed at making fwdpp easier to use.)</p>
<p>At this point, intuition (backed up by extensive code profiling using tools like Google's profiling library and valgrind's cachegrind) told me that the main hurdle to improving performance was to address memory usage.</p>
<p>Release 0.4.4 introduced a fundamental change in the library design:</p>
<ul>
<li>Extinct objects are no longer deleted. Instead, their locations are recorded in a FIFO queue. These queues are used to "recycle" already-allocated memory.</li>
<li>(Similarly, fixed variants can be tagged for recycling under many modeling situations.)</li>
<li>Once extinct objects are no longer removed, then there are no longer insertions/removals to/from the middle of containers. Rather, we either recycle an object, or add a newly-allocated object to the end.</li>
<li>Thus, we can replace doubly-linked lists with vectors.</li>
<li>Further, we can replace iterators with integers.</li>
</ul>
<p>All of these changes were introduced in one fell swoop in 0.4.4, along with a set of other API changes that I'd wanted to make for a while. The current design is conceptually the same as the published version, with 8 byte keys representing where mutations and haploid genomes are, thus ensuring that an object is only represented once in memory.</p>
<p>However, the new design is also less elegant. Now, the vectors of haploid genomes and mutations have to be passed along with the diploids.</p>
<p>So, why do this? <b>It is a lot faster!</b> Simulations of large genomic regions in large populations can be up to 80% faster! In fact, tcmalloc isn't necessary to get really good performance any more. Using it still improves run-times by about 10% (on Intel systems at least...), but that isn't a lot compared to the 50% improvement that it gave to previous versions of the library.</p>
<h1>Documentation</h1>
<h2>Online</h2>
<p>A tutorial on policies and the library's reference manual can be found at <a href="http://molpopgen.github.io/fwdpp">molpopgen.github.io/fwdpp</a> or <a class="el" href="d1/d7a/md_md_policies.html">here</a>.</p>
<p><b>Note:</b> the links above may be out of date, as the online documentation are not regenerated automatically. If you want the latest, builds the docs from source.</p>
<h2>Tutorials</h2>
<p><b>The first few tutorials are out of date due to API changes in 0.4.4. The basic ideas are the same, but you'll have to look at the example programs and unit tests for the best HOW-TOs until I fix these documents.</b></p>
<p>The <a href="http://molpopgen.github.io/fwdpp">fwdpp</a> main page contains several tutorials:</p>
<ul>
<li><a class="el" href="d5/d00/md_md_datatypes.html">Tutorial 0: Data types in fwdpp</a></li>
<li><a class="el" href="d1/d7a/md_md_policies.html">Tutorial 1: Policies in fwdpp</a></li>
<li><a class="el" href="d5/d9d/md_md_serialization.html">Writing data to binary formats</a></li>
<li><a class="el" href="db/dd8/md_md_sugar.html">Tutorial 5: the "sugar" layer on top of fwdpp</a></li>
</ul>
<h2>Built from source</h2>
<p>The source code documentation is in the doc subdirectory that comes with the library. There are two major pieces of documentation. First is the detailed documentation of all library functions. This is generated via <a href="http://www.doxygen.org">doxygen</a>, and the output is a folder called html. To view the documentation, point a browser to html/index.html.</p>
<h2>Example documentation</h2>
<p>The examples can be read in html form via the online reference manual linked to above. You can find the two simplest examples online at the fwdpp <a href="https://github.com/molpopgen/fwdpp/wiki">wiki</a> on github.</p>
<h1>Projects using fwdpp:</h1>
<ul>
<li><a href="https://github.com/molpopgen/fwdpp_perf">fwdpp_perf</a> is a collection of programs showing how to run independent simulations in a multi-core/many-core environment. Example programs use either C++11 threads or MPI to run simulations. I also use this package for performance testing/benchmarking/profiling/etc.</li>
<li><a href="https://github.com/molpopgen/fwdpy11">fwdpy11</a> brings fwdpp-powered simulations to the Python programming language.</li>
</ul>
<h1>Dependencies</h1>
<h2>System requirements</h2>
<p>You must have the following on your system:</p>
<ol type="1">
<li>A C++ compiler that supports the C++11 language standard.</li>
<li>Ideally, one should have the <a href="http://git-scm.com/book/en/Getting-Started-Installing-Git">git</a> command line tools installed. These are likely already installed on many systems.</li>
</ol>
<p>We routinely test fwdpp on several different systems with different compilers. The Travis CI build matrix for fwdpp includes:</p>
<ul>
<li>A miniconda3 environment using gcc 4.8.5 with <a href="http://github.com/molpopgen/libsequence">libsequence</a> installed via <a href="https://bioconda.github.io/">bioconda</a>.</li>
<li>GCC 5 or 6 on Ubuntu, with either C++11 or C++14. <a href="http://github.com/molpopgen/libsequence">libsequence</a> is not used for these builds.</li>
</ul>
<h2>Library dependencies</h2>
<p>The minimal dependencies required to use the library to develop simulations are:</p>
<ol type="1">
<li><a href="http://gnu.org/software/gsl">GSL</a></li>
<li><a href="http://zlib.net">zlib</a></li>
</ol>
<p>In order to compile the example programs, the following dependency is optional as of fwdpp 0.5.7:</p>
<ol type="1">
<li><a href="http://github.com/molpopgen/libsequence">libsequence</a>.</li>
</ol>
<p>As of fwdpp 0.7.0, some example programs require the <code>program_options</code> library from <a href="http://www.boost.org">boost</a>. This is one of boost's runtime libraries, meaning that you need a "full" boost installation. Conda provides such a thing, and Linux variants like Ubuntu provide the different runtime libraries as separate packages.</p>
<p>The configure script checks for these optional dependencies and will skip compilation of various example programs if they are missing.</p>
<p>In order to compile the unit tests, you also need:</p>
<ol type="1">
<li><a href="http://www.boost.org">boost</a>.</li>
</ol>
<p>For OS X users, all of the above dependencies are available via <a href="http://brew.sh">homebrew</a> or <a href="http://conda.pydata.org/docs/">conda</a>/<a href="https://bioconda.github.io">bioconda</a>.</p>
<h2>Performance</h2>
<p>Performance testing has been moved to the <a href="http://github.com/molpopgen/fwdpp_perf">fwdpp_perf</a> project.</p>
<h2>Obtaining the source code</h2>
<h3>Obtaining the master branch</h3>
<p>You have a few options:</p>
<ol type="1">
<li>Clone the repo (best option): git clone <a href="https://github.com/molpopgen/fwdpp.git">https://github.com/molpopgen/fwdpp.git</a></li>
<li>Click on "Download Zip" at <a href="https://github.com/molpopgen/fwdpp">https://github.com/molpopgen/fwdpp</a></li>
</ol>
<h3>Obtaining a specific release</h3>
<p>Again, a few options:</p>
<ol type="1">
<li>Click on "Releases" at <a href="https://github.com/molpopgen/fwdpp,">https://github.com/molpopgen/fwdpp,</a> then download the one you want</li>
<li>Clone the repo (see previous section)</li>
</ol>
<p>Or:</p>
<ol type="1">
<li>Get a list of releases by saying "git tag -l"</li>
<li>Checkout the release you want. For example "git checkout 0.2.6"</li>
</ol>
<p>Another option is to click on <a href="https://github.com/molpopgen/fwdpp/releases">releases</a> from the main <a href="https://github.com/molpopgen/fwdpp">project page</a> at github.</p>
<p>On a decent browser, when you click on a release, it should be called fwdpp-version.tar.gz. Sometimes, though, you may get version.tar.gz. This is a browser-by-github interaction problem. On my systems, I get the correct result.</p>
<h1>Installation</h1>
<h2>What does fwdpp install?</h2>
<p>Two things:</p>
<ul>
<li>The library itself, which is simply a set of C++ header files</li>
<li>A single binary called fwdppConfig, which you may use to check what version you have installed on your system.</li>
</ul>
<div class="fragment"><div class="line">fwdppConfig --version</div></div><!-- fragment --><p>fwdppConfig was introduced in version 0.3.3. Its main raison d'etre is in helping other configure scripts test for what version is on their system. For example, which may go into a configure.ac file for your project:</p>
<div class="fragment"><div class="line">dnl Check that fwdpp version is sufficient</div><div class="line">if test &quot;$FWDPPVERSION&quot; &gt; &quot;0.3.2&quot;</div><div class="line">then</div><div class="line">        echo &quot;fwdpp version $FWDPPVERSION detected&quot;</div><div class="line">else</div><div class="line">        AC_MSG_ERROR([fwdpp &gt;= 0.3.3 required, please install from http://github.com/molpopgen/fwdpp])</div><div class="line">fi</div></div><!-- fragment --><h2>The case of a standard system with all dependencies installed in standard locations</h2>
<p>If you cloned the git repo: </p><div class="fragment"><div class="line">cd fwdpp</div></div><!-- fragment --><p> If you downloaded a release:</p>
<div class="fragment"><div class="line">tar xzf fwdpp-version.tar.gz</div><div class="line">cd fwdpp-version</div></div><!-- fragment --><p>Then:</p>
<div class="fragment"><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div></div><!-- fragment --><p>To compile examples and unit tests, and to execute unit tests:</p>
<div class="fragment"><div class="line">make check</div></div><!-- fragment --><p>Currently, the example programs will not get installed via "make install". If you want them to be installed system-wide, copy the binaries manually to where you need them.</p>
<h2>To compile examples and unit tests</h2>
<p><b>Note:</b> if you only wish to compile the example programgs, issue the 'make check' command from the example subdirectory. This will allow users without boost on their system to compile the examples but not attempt to compile the unit tests (which will fail to compile on systems without boost).</p>
<p>You will need <a href="http://github.com/molpopgen/libsequence">libsequence</a> installed on your system in order to compile the example programs.</p>
<h2>If dependent libraries are in non-stanard locations.</h2>
<p>For example, if libsequence is in /opt:</p>
<div class="fragment"><div class="line">#Note, you need to add in the desired optimization (-OXX) level:</div><div class="line">CPPFLAGS=&quot;-I/opt/include&quot; LDFLAGS=&quot;$LDFLAGS -L/opt/lib -Wl,-rpath/opt/lib&quot; ./configure </div><div class="line">make check</div><div class="line">make install</div></div><!-- fragment --><p>The "-Wl,-rpath" business adds the library path locations into the compiled binaries. The flags work on GCC and clang compilers, and are often handy when using systems like Anaconda or Homebrew to manage dependencies.</p>
<h2>Installing in a custom location</h2>
<div class="fragment"><div class="line">./configure --prefix=/path/2/where/you/want it</div></div><!-- fragment --><p> For example:</p>
<div class="fragment"><div class="line">./configure --prefix=$HOME</div></div><!-- fragment --><h2>Examples</h2>
<p>The examples are documented <a class="el" href="df/dcb/md_md_examples.html">here</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
