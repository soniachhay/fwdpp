<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>fwdpp: Tutorial: obtain a sample from a population as a matrix type.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">fwdpp
   &#160;<span id="projectnumber">0.5.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial: obtain a sample from a population as a matrix type. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Version 0.5.4 added <a class="el" href="dd/dc8/structKTfwd_1_1data__matrix.html" title="Genotype or haplotype matrix. ">KTfwd::data_matrix</a>, which represents a sample from a population as a matrix (a one-dimensional vector plus the number of rows/columns).</p>
<p>There are two types of matrix:</p>
<ul>
<li>Haplotype. This consists of two rows/individual. Data are encoded as 0 = ancetral, 1 = derived.</li>
<li>Genotype. There is one row per individual. Data are encoded as 0,1, or 2 copies of the derived allele.</li>
</ul>
<p>These objects are generated by <a class="el" href="da/d8b/namespaceKTfwd.html#a49c160799f6908391894a47ae2dd9295">KTfwd::haplotype_matrix</a> and <a class="el" href="da/d8b/namespaceKTfwd.html#a0f29aa671a95ece48172e57a8accdfae">KTfwd::genotype_matrix</a>, respectively, where the input is a list of indexes of individuals and <b>keys</b> to the mutations present in the sample. A list of keys is generated by <a class="el" href="da/d8b/namespaceKTfwd.html#a72c43f31bf60f0d165b0f87019723b95">KTfwd::mutation_keys</a>. Please see the documentation of that function for details about its return value. The return value of <a class="el" href="da/d8b/namespaceKTfwd.html#a72c43f31bf60f0d165b0f87019723b95">KTfwd::mutation_keys</a> may be filtered manually to further fine-tune the sample (remove fixed mutations, apply frequency filters, etc.).</p>
<p>The type <a class="el" href="dd/dc8/structKTfwd_1_1data__matrix.html" title="Genotype or haplotype matrix. ">KTfwd::data_matrix</a> stores the data in a C++ vector of type char, which is space-efficient while still allowing easy conversion to matrix types from other libraries. The data types are easily used in combination with the GSL matrix types, with no need for additional memory allocation.</p>
<p>The memory layout of the matrix is "C-style", or row-major, to make the objects compatible with GSL types, NumPy array types, etc.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="df/dce/matrix_8hpp.html">fwdpp/sugar/matrix.hpp</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;gsl/gsl_matrix_char.h&gt;</span></div><div class="line"><span class="comment">//assume poptype represents some single-deme object</span></div><div class="line"><a class="code" href="d0/da3/extensions__regionsTest_8cc.html#aa222338fad215f6f35c2f630479ddbf3">poptype</a> p;</div><div class="line"><span class="comment">//Evolve the population...(step skipped)</span></div><div class="line"></div><div class="line"><span class="comment">//Generate keys for the mutations found in individuals</span></div><div class="line"><span class="comment">//0,1, and 2, for both neutral and selected mutations</span></div><div class="line"><a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9821aec63f7eb16e2b35ab0af5921833">keys</a> = <a class="code" href="da/d8b/namespaceKTfwd.html#a72c43f31bf60f0d165b0f87019723b95">KTfwd::mutation_keys</a>(p,{0,1,2},<span class="keyword">true</span>,<span class="keyword">true</span>);</div><div class="line">hm = <a class="code" href="da/d8b/namespaceKTfwd.html#a49c160799f6908391894a47ae2dd9295">KTfwd::haplotype_matrix</a>(<a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9a6b0db86fb18456d7ed0ce7fdfe45f6">pop</a>,{0,1,2},<a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9821aec63f7eb16e2b35ab0af5921833">keys</a>.first,<a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9821aec63f7eb16e2b35ab0af5921833">keys</a>.second);</div><div class="line"><span class="comment">//Create a GSL matrix type for the neutral mutations</span></div><div class="line"><span class="comment">//neutral_matrix will have the type gsl_matrix_char_const_view</span></div><div class="line"><span class="keyword">auto</span> neutral_matrix =  gsl_matrix_char_const_view_array(hm.neutral.data(),</div><div class="line">                                                        hm.nrow, hm.neutral_positions.size());</div></div><!-- fragment --><p>To get the matrix for selected mutations, replace neutral_ with selected_ in the last line of the above example.</p>
<p>The above code sketch gives you a GSL matrix that you can use in the normal fashion for that library.</p>
<p>Sometimes, you'll need a matrix to be based on a floating-point type. In such cases, you'll need to make a copy of the data:</p>
<div class="fragment"><div class="line"><span class="comment">//This is the main GSL matrix header.</span></div><div class="line"><span class="comment">//GSL functions on matrix/vector types</span></div><div class="line"><span class="comment">//assume double is the data.</span></div><div class="line"><span class="comment">//See GSL manual for more info.</span></div><div class="line"><span class="preprocessor">#include &lt;gsl/gsl_matrix.h&gt;</span></div><div class="line">hm = <a class="code" href="da/d8b/namespaceKTfwd.html#a49c160799f6908391894a47ae2dd9295">KTfwd::haplotype_matrix</a>(<a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9a6b0db86fb18456d7ed0ce7fdfe45f6">pop</a>,{0,1,2},<a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9821aec63f7eb16e2b35ab0af5921833">keys</a>.first,<a class="code" href="d0/d1a/sugar__matrixTest_8cc.html#a9821aec63f7eb16e2b35ab0af5921833">keys</a>.second);</div><div class="line"><span class="comment">//Copy the vector of chars to a vector of doubles</span></div><div class="line">std::vector&lt;double&gt; neutral(hm.neutral.begin(),hm.neutral.end());</div><div class="line"><span class="comment">//neutral_matrix is gsl_matrix_const_view</span></div><div class="line"><span class="keyword">auto</span> neutral_matrix =  gsl_matrix_const_view_array(hm.neutral.data(),</div><div class="line">                                                        hm.nrow, hm.neutral_positions.size());</div></div><!-- fragment --><p>I've made <b>constant</b> objects to view the data in GSL matrix form. You could use the non-const versions, but you would need to be careful. There are other data types in <a class="el" href="dd/dc8/structKTfwd_1_1data__matrix.html" title="Genotype or haplotype matrix. ">KTfwd::data_matrix</a> that could become inconsistent in the event that the main data matrix is modified.</p>
<p>For more examples of using these functions, see the source code of the unit test file <a class="el" href="d0/d1a/sugar__matrixTest_8cc.html">sugar_matrixTest.cc</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
